#include <wiringPi.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <stddef.h>
#include <stdio.h>

#define LED 0

uint8_t frequency = 40;
char samsung_on_str[] = "sony_on";
uint16_t samsung_on[] = {0xAC, 0xAC, 0x15, 0x40, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x689};
char samsung_off_str[] = "sony_off";
uint16_t samsung_off[] = {0xAC, 0xAC, 0x15, 0x40, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x15, 0x15, 0x40, 0x15, 0x40, 0x15, 0x15, 0x15, 0x689};
uint8_t half_mark;

void mark(uint16_t dur){
    for(uint16_t i = 0; i < dur; i++){
        digitalWrite(LED, HIGH);
        delayMicroseconds(half_mark);
        digitalWrite(LED, LOW);
        delayMicroseconds(half_mark);
    }
}

void space(uint16_t dur){
    for(uint16_t i = 0; i < dur; i++){
        digitalWrite(LED, LOW);
        delayMicroseconds(half_mark);
        digitalWrite(LED, LOW);
        delayMicroseconds(half_mark);
    }
}

int main(int argc, char *argv[]){
    wiringPiSetup();
    pinMode(LED, OUTPUT);
    half_mark = ((1000 / frequency) / 2) - 1;
    if(!strcmp(argv[1], samsung_on_str)){
        for(uint8_t i = 0; i < 4; i++){
            for(uint8_t i = 0; i < (sizeof(samsung_on) / sizeof(samsung_on[0])); i++){
                if (i & 0x01){
                    space(samsung_on[i]);
                }else{
                    mark(samsung_on[i]);
                }
            }
        }
    }else if(!strcmp(argv[1], samsung_off_str)){
        for(uint8_t i = 0; i < 4; i++){
            for(uint8_t i = 0; i < (sizeof(samsung_off) / sizeof(samsung_off[0])); i++){
                if (i & 0x01){
                    space(samsung_off[i]);
                }else{
                    mark(samsung_off[i]);
                }
            }
        }
    }
}
